---
title: "Examining reduced features"
output:
  pdf_document: default
  html_notebook: default
  github_document:
  pandoc_args: --webtex
---

# Load libraries

```{r message = FALSE, warning = FALSE}
library(tidyverse)
```

```{r echo=FALSE}
# Load data
load("reduced_feature_inventories.Rdata")
```

# Prepare the data

Flattening the list
```{r echo=FALSE}
answers %>% enframe() %>% 
  unnest(value) -> answers.df
answers.df
```

The next stage is providing the IDs and then unnesting further:
```{r echo=FALSE}
answers.df %>% 
  mutate(min.features = lengths(value)) %>% 
  mutate(ID = seq.int(nrow(answers.df))) %>%
  unnest(value) -> answers.df
answers.df
```

# Questions

## (1) Are there features that are in all answers in all languages?

```{r echo=FALSE}
length(unique(answers.df$name))
```

We have 1519 languages. 

What about the distribution of features: we count it here a bit more explicit than necessary:

```{r echo=FALSE}
answers.df %>% group_by(name, value) %>% summarize(total = n()) -> answers.feature
answers.feature %>% group_by(value)  %>% summarize(total = n()) %>% 
  arrange (desc(total)) -> feature.total
feature.total
```

Answer: almost but not, labial is the most common but it is missing in 6 languages

## (2) What's the distribution?

We cheat here a bit and take the summarized df **feature.total** to produce the bar plot, otherwise one would have to order the factor before plotting

```{r echo=FALSE, fig.asp = 0.6}
ggplot(feature.total, aes(reorder(x = value, -total), y= total)) +
  geom_bar(stat="identity") +
  theme(axis.text.x=element_text(angle=45, hjust=1)) +
  labs(x = "Feature", y = "Nr. of languages")+
  ggtitle("Feature frequency by language")
```

## (3) How many different features for each language?

We take the object **answers.df**, group it by `feature` and `language` and summarize with `n_distinct()`:

```{r echo=FALSE}
answers.df %>% group_by(name) %>% summarize(total = n_distinct(value)) -> answers.feature.in.lg
answers.feature.in.lg
```

A histogram for this needs some bin fixing, so here is a bar plot

```{r echo=FALSE, fig.asp = 0.4}
ggplot(answers.feature.in.lg, aes(x= total)) +
  geom_bar()
```

# Top features

Our `n` per language is the minimal number of features `min.features` in the different permutations.

We first group by language and feature and sum up how frequent the individual features are in the variable `nr.of.permutations`:

```{r echo=FALSE}
answers.df %>% group_by(name, value, min.features) %>% 
  summarize(nr.of.permutations =n()) -> features.by.language
features.by.language
```

Add the variable `feature.rank`, use `ties.method = "min"` so the multiple winners are allowed:

```{r echo=FALSE}
features.by.language %>% group_by(name) %>% 
  mutate(feature.rank = rank(desc(nr.of.permutations), ties.method = "min")) -> features.by.language
features.by.language
```

Filter only the top features:

```{r echo=FALSE}
features.by.language %>% filter(feature.rank <= min.features) -> top.features
top.features
```

Next we summarize the top features across languages:

```{r echo=FALSE}
top.features %>% group_by(value) %>% 
  summarize(freq = n()) %>% arrange(desc(freq)) -> summary.top.features
summary.top.features
```

How's it look?

```{r echo=FALSE, fig.asp = 0.5}
ggplot(summary.top.features, aes(reorder(x = value, -freq), y = freq)) +
  geom_bar(stat="identity") +
  theme(axis.text.x=element_text(angle=45, hjust=1)) +
  labs(x = "Feature", y = "Nr. of languages")+
  ggtitle("Top features")
```
