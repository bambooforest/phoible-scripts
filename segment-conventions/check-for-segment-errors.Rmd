---
title: "Check for errors in PHOIBLE segment conventions"
author: "Steven Moran \\<steven.moran@uzh.ch\\>"
output: github_document
---
  
```{r, message=F, warning=F}
library(testthat)
library(dplyr)
library(knitr)
```


```{r}
load(url('https://github.com/phoible/dev/blob/master/data/phoible.RData?raw=true'))
expect_equal(nrow(phoible), 105467)
```

```{r}
# Get a list of unique segments and which sources they appear in
phoneme.source <- phoible %>% select(Phoneme, Source) %>% group_by(Phoneme, Source) %>% distinct()
distinct.segments <- phoneme.source %>% group_by(Phoneme) %>% summarize(Sources=tolower(paste(Source, collapse=";"))) %>% arrange(Phoneme)
expect_equal(nrow(distinct.segments), 3183)
head(distinct.segments)
```

```{r}
write.csv(distinct.segments, file="distinct-segments.csv", row.names = F)
```

```{r}
# Check for ambigously placed segments, e.g. ring above and below (awful hack here because copy and pasting diacritics in R studio is problematic)
rings.below <- distinct.segments %>% filter(grepl("̥", Phoneme))
rings.above <- distinct.segments %>% filter(grepl("̊", Phoneme))
rings <- rbind(rings.above, rings.below)
rings <- rings %>% arrange(Phoneme)
write.csv(rings, file="rings.csv", row.names = F)

kable(rings)
```

